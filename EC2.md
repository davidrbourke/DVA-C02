# EC2

## Basics

Elastic Compute - Infrastructure as a service

- VMs (EC2)
- Storing data on Virtual Drives (EBS)
- Distributing load balancing (ELB)
- Auto-scaling Groups (ASG)
- Bootstrapping - run scripts on start up, e.g. installing software

IP is dynamic by default. A new IP is generated for the VM between restarts.

## Types of instances

https://aws.amazon.com/ec2/instance-types/

### Naming convention

Example: M6.2xlarge

#### Explained

- Class, e.g. M
- Generation, e.g. 6
- Size, e.g. 2xlarge

### Classes

- General Purpose - balanced, e.g. web servers, diverse workloads (M class)
- Compute Optimized - e.g. gaming, machine learning, intensive CPU usage, etc. (C class)
- Memory Optimized - e.g. in-memory databases, etc. (R & X class)
- Storage Optimized - high frequency OLTP systems, cache for in-memory, data warehouses, etc. (I & D class)

## Firewalls

### Security Groups

Security Groups control traffic allowed in and out of EC2 instances.

- Only contains **allow** rules.
- Can reference by IP, or by other Security Groups.
- Regulate

  - Access to ports
  - Authorised IP ranges
  - control of inbound network
  - control of outbound network

- Can be attached to multiple instances
- Locked down to specific regions
- Live outside of the EC2, EC2 won't see blocked traffic

#### In Practice

- Maintain one separate security group for SSH access (best practice)
- Timeout errors - means security group blocked
- Connection refused, or other error - means application was reached by there is some issue.
- Referencing other security groups allows EC2 instances that share the same SG to communicate with each other.

Example

```
  Type: HTTP
  Protocol: TCP
  Port Range: 80
  Source: 0.0.0.0/0
  Description: ...
```

#### Common Ports

- SSH: 22
- FTP: 21
- SFTP: 22
- HTTP: 80
- HTTPS: 443
- RDP: 3389 (Remote Desktop for a Window instance)

## Connecting into EC2

On Linux, Max, Windows 10+ use SSH.
Windows less than v10, use Putty.
Web Browser - EC2 Instance Connect - Only works with Amazon Linux 2 (OS on VM). A .pem file will be automatically created. Existing Security Group rules still apply.

### On Windows connect via SSH

1. Be in the same directory as the .pem file downloaded when setting up the EC2 instance.
2. Ensure there are no spaces in the .pem file name.
3. Enter command: `ssh -i EC2Tutorial.pem ec2-user@3.252.149.106`
   1. ec2-user is the user generated by AL2.
   2. Enter the public IP of the EC2 instance.
4. Issues
   1. Ensure your user is the owner of the .pem file
   2. Remove all inherited permissions, and ensure only you are the principal of the .pem file.

## EC2 Instance Roles

SSH into EC2 and run `aws iam list-users`. This will return `Unable to locate credentials. You can configure credentials by running "aws configure".`  
**Do not run aws configure**, this would give anyone who accesses the EC2 instance permissions with your credentials. You need to assign a role to the EC2 in the AWS Console. Go to the EC2 Instance options `Actions` > `Security` > `Modify IAM role`. Here you can assign the role with permissions.  
For this a role was create in IAM for EC2 called DemoRoleForEC2 and assigned to the EC2 with a policy of **IAMReadOnlyAccess**. Output of `aws iam list-users` is now:

```
{
    "Users": [
        {
            "Path": "/",
            "UserName": "-",
            "UserId": "-",
            "Arn": "-",
            "CreateDate": "2025-06-16T07:33:07+00:00",
            "PasswordLastUsed": "2025-08-05T07:11:07+00:00"
        }
    ]
}
```
